<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <title>osmia-npm with wasm</title>
    </head>
    <body>
        <div id="root">
            <div class="row">
                <input type="checkbox" id="chkCtx" checked/>
                <label for="chkCtx">Context</label>
            </div>
            <div class="row">
                <textarea id="code"
                    type="text"
                    placeholder="Enter code" rows="25"
                ></textarea>
                <textarea id="ctx"
                    type="text" class=""
                    placeholder="Enter ctx as json" rows="25"
                ></textarea>
            </div>
            <button id="run">Run</button>
            <pre id="output"></pre>
        </div>
        <script type="module">
            import init, { run, run_ctx } from "./pkg/osmia_npm.js";
            init().then(() => {
                const codeContainer = document.getElementById("code");
                const ctxContainer = document.getElementById("ctx");
                const resultContainer = document.getElementById("output");
                const btn = document.getElementById("run");
                const chkCtx = document.getElementById("chkCtx");

                const runCode = () => {
                    const code = codeContainer.value;
                    let result;
                    try {
                        if (chkCtx.checked) {
                            result = run_ctx(ctxContainer.value, code);
                        }
                        else {
                            result = run(code);
                        }
                    }
                    catch (e) {
                        result = e;
                    }
                    console.table([
                        {
                            "variable": "code",
                            "value": code
                        },
                        {
                            "variable": "ctx",
                            "value": chkCtx.checked ? ctxContainer.value : null
                        },
                        {
                            "variable": "result",
                            "value": result
                        }
                    ],["variable", "value"]);
                    resultContainer.innerHTML = result;
                };

                chkCtx.addEventListener("change", () => {
                    ctxContainer.classList.toggle("hide", !chkCtx.checked);
                });
                btn.addEventListener("click", runCode);

                codeContainer.value = `
Osmia {{ _OSMIA_VERSION }} - npm {{ _OSMIA_NPM_VERSION }}

Hello {{ user.name }}!
`.trim();
                ctxContainer.value = `
{
  "user": {
    "name": "marvin"
  }
}`.trim();
            });
        </script>
    <style>
        body, #root {
            display: flex;
            flex-direction: column;
        }

        #root {
            gap: 10px;
        }

        #run {
            padding: 10px;
        }

        .row {
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        #code, #ctx {
            width: 100%;
        }

        .hide {
            display: none;
        }
    </body>
</html>
